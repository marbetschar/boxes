#cloud-config
groups:
  - sudo
  - wheel
users:
  - name: $USER
    groups: [sudo,wheel]
    sudo: ALL=(ALL) NOPASSWD:ALL
packages:
  - sudo
  - x11-apps
  - mesa-utils
  - pulseaudio
  - ubuntu-desktop
  - lightdm
  - lightdm-gtk-greeter
runcmd:
  - groupmod --gid $GID $USER
  - usermod --gid $GID --uid $UID $USER
  - echo '$USER:$USER' | chpasswd
  - sed -i "s/; enable-shm = yes/enable-shm = no/g" /etc/pulse/client.conf
  - ln --symbolic --force /lib/systemd/system/lightdm.service /etc/systemd/system/display-manager.service
write_files:
  - content: |
      [Seat:*]
      autologin-user=$USER
      autologin-user-timeout=0
      type=xremote
      xserver-display-number=0
      greeter-session=lightdm-gtk-greeter
    path: /etc/lightdm/lightdm.conf.d/10-tins-x11.conf
