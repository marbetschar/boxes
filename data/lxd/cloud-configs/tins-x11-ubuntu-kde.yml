#cloud-config
groups:
  - sudo
  - wheel
users:
  - name: $USER
    groups: [sudo,wheel]
    sudo: ALL=(ALL) NOPASSWD:ALL
packages:
  - sudo
  - x11-apps
  - mesa-utils
  - pulseaudio
  - kubuntu-desktop
  - lightdm
  - lightdm-gtk-greeter
runcmd:
  - groupmod --gid $GID $USER
  - usermod --gid $GID --uid $UID --password $(openssl passwd -1 $USER) $USER
  - sed -i "s/; enable-shm = yes/enable-shm = no/g" /etc/pulse/client.conf
  - echo "/usr/sbin/lightdm" > /etc/X11/default-display-manager
  - DEBIAN_FRONTEND=noninteractive DEBCONF_NONINTERACTIVE_SEEN=true dpkg-reconfigure lightdm
  - echo set shared/default-x-display-manager lightdm | debconf-communicate
write_files:
  - content: |
      [Seat:*]
      autologin-user=$USER
      autologin-user-timeout=0
      type=xremote
      xserver-display-number=0
      greeter-session=lightdm-gtk-greeter
    path: /etc/lightdm/lightdm.conf.d/10-tins-x11.conf
